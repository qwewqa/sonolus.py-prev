from dataclasses import dataclass

from sonolus.backend.ir import MemoryBlock


@dataclass(frozen=True)
class CallbackType:
    name: str
    readable_blocks: set[MemoryBlock]
    writable_blocks: set[MemoryBlock]

    def __hash__(self):
        return hash(self.name)


DEBUG_CALLBACK_TYPE = CallbackType(
    "_debug_",
    set(MemoryBlock),
    set(MemoryBlock),
)

CALLBACK_TYPES = {
    "preprocess": CallbackType(
        name="preprocess",
        readable_blocks={
            MemoryBlock.LEVEL_MEMORY,
            MemoryBlock.LEVEL_DATA,
            MemoryBlock.LEVEL_OPTION,
            MemoryBlock.LEVEL_TRANSFORM,
            MemoryBlock.LEVEL_BACKGROUND,
            MemoryBlock.LEVEL_UI,
            MemoryBlock.LEVEL_BUCKET,
            MemoryBlock.LEVEL_SCORE,
            MemoryBlock.LEVEL_LIFE,
            MemoryBlock.LEVEL_UI_CONFIGURATION,
            MemoryBlock.ENTITY_INFO_ARRAY,
            MemoryBlock.ENTITY_DATA_ARRAY,
            MemoryBlock.ENTITY_SHARED_MEMORY_ARRAY,
            MemoryBlock.ENTITY_INFO,
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_DATA,
            MemoryBlock.ENTITY_INPUT,
            MemoryBlock.ENTITY_SHARED_MEMORY,
            MemoryBlock.ARCHETYPE_LIFE,
        },
        writable_blocks={
            MemoryBlock.LEVEL_MEMORY,
            MemoryBlock.LEVEL_DATA,
            MemoryBlock.LEVEL_OPTION,
            MemoryBlock.LEVEL_TRANSFORM,
            MemoryBlock.LEVEL_BACKGROUND,
            MemoryBlock.LEVEL_UI,
            MemoryBlock.LEVEL_BUCKET,
            MemoryBlock.LEVEL_SCORE,
            MemoryBlock.LEVEL_LIFE,
            MemoryBlock.LEVEL_UI_CONFIGURATION,
            MemoryBlock.ENTITY_DATA_ARRAY,
            MemoryBlock.ENTITY_SHARED_MEMORY_ARRAY,
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_DATA,
            MemoryBlock.ENTITY_INPUT,
            MemoryBlock.ENTITY_SHARED_MEMORY,
            MemoryBlock.ARCHETYPE_LIFE,
        },
    ),
    "spawn_order": CallbackType(
        name="spawnOrder",
        readable_blocks={
            MemoryBlock.LEVEL_MEMORY,
            MemoryBlock.LEVEL_DATA,
            MemoryBlock.LEVEL_OPTION,
            MemoryBlock.LEVEL_TRANSFORM,
            MemoryBlock.LEVEL_BACKGROUND,
            MemoryBlock.LEVEL_UI,
            MemoryBlock.LEVEL_UI_CONFIGURATION,
            MemoryBlock.LEVEL_BUCKET,
            MemoryBlock.LEVEL_SCORE,
            MemoryBlock.LEVEL_LIFE,
            MemoryBlock.ENTITY_INFO_ARRAY,
            MemoryBlock.ENTITY_DATA_ARRAY,
            MemoryBlock.ENTITY_SHARED_MEMORY_ARRAY,
            MemoryBlock.ENTITY_INFO,
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_DATA,
            MemoryBlock.ENTITY_INPUT,
            MemoryBlock.ENTITY_SHARED_MEMORY,
            MemoryBlock.ARCHETYPE_LIFE,
        },
        writable_blocks={
            MemoryBlock.LEVEL_MEMORY,
            MemoryBlock.LEVEL_DATA,
            MemoryBlock.LEVEL_OPTION,
            MemoryBlock.LEVEL_TRANSFORM,
            MemoryBlock.LEVEL_BACKGROUND,
            MemoryBlock.LEVEL_UI,
            MemoryBlock.LEVEL_UI_CONFIGURATION,
            MemoryBlock.LEVEL_BUCKET,
            MemoryBlock.LEVEL_SCORE,
            MemoryBlock.LEVEL_LIFE,
            MemoryBlock.ENTITY_DATA_ARRAY,
            MemoryBlock.ENTITY_SHARED_MEMORY_ARRAY,
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_DATA,
            MemoryBlock.ENTITY_INPUT,
            MemoryBlock.ENTITY_SHARED_MEMORY,
            MemoryBlock.ARCHETYPE_LIFE,
        },
    ),
    "should_spawn": CallbackType(
        name="shouldSpawn",
        readable_blocks={
            MemoryBlock.LEVEL_MEMORY,
            MemoryBlock.LEVEL_DATA,
            MemoryBlock.LEVEL_OPTION,
            MemoryBlock.LEVEL_TRANSFORM,
            MemoryBlock.LEVEL_BACKGROUND,
            MemoryBlock.LEVEL_UI,
            MemoryBlock.LEVEL_UI_CONFIGURATION,
            MemoryBlock.LEVEL_BUCKET,
            MemoryBlock.LEVEL_SCORE,
            MemoryBlock.LEVEL_LIFE,
            MemoryBlock.ENTITY_INFO_ARRAY,
            MemoryBlock.ENTITY_DATA_ARRAY,
            MemoryBlock.ENTITY_SHARED_MEMORY_ARRAY,
            MemoryBlock.ENTITY_INFO,
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_DATA,
            MemoryBlock.ENTITY_INPUT,
            MemoryBlock.ENTITY_SHARED_MEMORY,
            MemoryBlock.ARCHETYPE_LIFE,
        },
        writable_blocks={
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_INPUT,
        },
    ),
    "initialize": CallbackType(
        name="initialize",
        readable_blocks={
            MemoryBlock.LEVEL_MEMORY,
            MemoryBlock.LEVEL_DATA,
            MemoryBlock.LEVEL_OPTION,
            MemoryBlock.LEVEL_TRANSFORM,
            MemoryBlock.LEVEL_BACKGROUND,
            MemoryBlock.LEVEL_UI,
            MemoryBlock.LEVEL_UI_CONFIGURATION,
            MemoryBlock.LEVEL_BUCKET,
            MemoryBlock.LEVEL_SCORE,
            MemoryBlock.LEVEL_LIFE,
            MemoryBlock.ENTITY_INFO_ARRAY,
            MemoryBlock.ENTITY_DATA_ARRAY,
            MemoryBlock.ENTITY_SHARED_MEMORY_ARRAY,
            MemoryBlock.ENTITY_INFO,
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_DATA,
            MemoryBlock.ENTITY_INPUT,
            MemoryBlock.ENTITY_SHARED_MEMORY,
            MemoryBlock.ARCHETYPE_LIFE,
        },
        writable_blocks={
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_INPUT,
        },
    ),
    "update_sequential": CallbackType(
        name="updateSequential",
        readable_blocks={
            MemoryBlock.LEVEL_MEMORY,
            MemoryBlock.LEVEL_DATA,
            MemoryBlock.LEVEL_OPTION,
            MemoryBlock.LEVEL_TRANSFORM,
            MemoryBlock.LEVEL_BACKGROUND,
            MemoryBlock.LEVEL_UI,
            MemoryBlock.LEVEL_UI_CONFIGURATION,
            MemoryBlock.LEVEL_BUCKET,
            MemoryBlock.LEVEL_SCORE,
            MemoryBlock.LEVEL_LIFE,
            MemoryBlock.ENTITY_INFO_ARRAY,
            MemoryBlock.ENTITY_DATA_ARRAY,
            MemoryBlock.ENTITY_SHARED_MEMORY_ARRAY,
            MemoryBlock.ENTITY_INFO,
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_DATA,
            MemoryBlock.ENTITY_INPUT,
            MemoryBlock.ENTITY_SHARED_MEMORY,
            MemoryBlock.ARCHETYPE_LIFE,
        },
        writable_blocks={
            MemoryBlock.LEVEL_MEMORY,
            MemoryBlock.LEVEL_TRANSFORM,
            MemoryBlock.LEVEL_BACKGROUND,
            MemoryBlock.ENTITY_SHARED_MEMORY_ARRAY,
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_INPUT,
            MemoryBlock.ENTITY_SHARED_MEMORY,
        },
    ),
    "touch": CallbackType(
        name="touch",
        readable_blocks={
            MemoryBlock.LEVEL_MEMORY,
            MemoryBlock.LEVEL_DATA,
            MemoryBlock.LEVEL_OPTION,
            MemoryBlock.LEVEL_TRANSFORM,
            MemoryBlock.LEVEL_BACKGROUND,
            MemoryBlock.LEVEL_UI,
            MemoryBlock.LEVEL_UI_CONFIGURATION,
            MemoryBlock.LEVEL_BUCKET,
            MemoryBlock.LEVEL_SCORE,
            MemoryBlock.LEVEL_LIFE,
            MemoryBlock.ENTITY_INFO_ARRAY,
            MemoryBlock.ENTITY_DATA_ARRAY,
            MemoryBlock.ENTITY_SHARED_MEMORY_ARRAY,
            MemoryBlock.ENTITY_INFO,
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_DATA,
            MemoryBlock.ENTITY_INPUT,
            MemoryBlock.ENTITY_SHARED_MEMORY,
            MemoryBlock.ARCHETYPE_LIFE,
            MemoryBlock.TEMPORARY_MEMORY,
            MemoryBlock.TEMPORARY_DATA,
        },
        writable_blocks={
            MemoryBlock.LEVEL_MEMORY,
            MemoryBlock.LEVEL_TRANSFORM,
            MemoryBlock.LEVEL_BACKGROUND,
            MemoryBlock.ENTITY_SHARED_MEMORY_ARRAY,
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_INPUT,
            MemoryBlock.ENTITY_SHARED_MEMORY,
            MemoryBlock.TEMPORARY_MEMORY,
        },
    ),
    "update_parallel": CallbackType(
        name="updateParallel",
        readable_blocks={
            MemoryBlock.LEVEL_MEMORY,
            MemoryBlock.LEVEL_DATA,
            MemoryBlock.LEVEL_OPTION,
            MemoryBlock.LEVEL_TRANSFORM,
            MemoryBlock.LEVEL_BACKGROUND,
            MemoryBlock.LEVEL_UI,
            MemoryBlock.LEVEL_UI_CONFIGURATION,
            MemoryBlock.LEVEL_BUCKET,
            MemoryBlock.LEVEL_SCORE,
            MemoryBlock.LEVEL_LIFE,
            MemoryBlock.ENTITY_INFO_ARRAY,
            MemoryBlock.ENTITY_DATA_ARRAY,
            MemoryBlock.ENTITY_SHARED_MEMORY_ARRAY,
            MemoryBlock.ENTITY_INFO,
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_DATA,
            MemoryBlock.ENTITY_INPUT,
            MemoryBlock.ENTITY_SHARED_MEMORY,
            MemoryBlock.ARCHETYPE_LIFE,
        },
        writable_blocks={
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_INPUT,
        },
    ),
    "terminate": CallbackType(
        name="terminate",
        readable_blocks={
            MemoryBlock.LEVEL_MEMORY,
            MemoryBlock.LEVEL_DATA,
            MemoryBlock.LEVEL_OPTION,
            MemoryBlock.LEVEL_TRANSFORM,
            MemoryBlock.LEVEL_BACKGROUND,
            MemoryBlock.LEVEL_UI,
            MemoryBlock.LEVEL_UI_CONFIGURATION,
            MemoryBlock.LEVEL_BUCKET,
            MemoryBlock.LEVEL_SCORE,
            MemoryBlock.LEVEL_LIFE,
            MemoryBlock.ENTITY_INFO_ARRAY,
            MemoryBlock.ENTITY_DATA_ARRAY,
            MemoryBlock.ENTITY_SHARED_MEMORY_ARRAY,
            MemoryBlock.ENTITY_INFO,
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_DATA,
            MemoryBlock.ENTITY_INPUT,
            MemoryBlock.ENTITY_SHARED_MEMORY,
            MemoryBlock.ARCHETYPE_LIFE,
        },
        writable_blocks={
            MemoryBlock.ENTITY_MEMORY,
            MemoryBlock.ENTITY_INPUT,
        },
    ),
}
